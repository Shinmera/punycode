(defpackage #:org.shirakumo.punycode.test
  (:use #:cl #:parachute #:org.shirakumo.punycode)
  (:export #:punycode))
(in-package #:org.shirakumo.punycode.test)

(parachute:define-test punycode)

(parachute:define-test encode
  :parent punycode
  (is string= "a-" (encode "a"))
  (is string= "A-" (encode "A"))
  (is string= "3-" (encode "3"))
  (is string= "--" (encode "-"))
  (is string= "---" (encode "--"))
  (is string= "London-" (encode "London"))
  (is string= "Lloyd-Atkinson-" (encode "Lloyd-Atkinson"))
  (is string= "This has spaces-" (encode "This has spaces"))
  (is string= "-> $1.00 <--" (encode "-> $1.00 <-"))
  (is string= "80a" (encode "Ð°"))
  (is string= "tda" (encode "Ã¼"))
  (is string= "mxa" (encode "Î±"))
  (is string= "fsq" (encode "ä¾‹"))
  (is string= "n28h" (encode "ðŸ˜‰"))
  (is string= "mxacd" (encode "Î±Î²Î³"))
  (is string= "Mnchen-3ya" (encode "MÃ¼nchen"))
  (is string= "Mnchen-3ya-" (encode "Mnchen-3ya"))
  (is string= "Mnchen-Ost-9db" (encode "MÃ¼nchen-Ost"))
  (is string= "Bahnhof Mnchen-Ost-u6b" (encode "Bahnhof MÃ¼nchen-Ost"))
  (is string= "abcdef-qua4k" (encode "abÃ¦cdÃ¶ef"))
  (is string= "80aafi6cg" (encode "Ð¿Ñ€Ð°Ð²Ð´Ð°"))
  (is string= "22cdfh1b8fsa" (encode "à¸¢à¸ˆà¸†à¸Ÿà¸„à¸à¸‚"))
  (is string= "hq1bm8jm9l" (encode "ë„ë©”ì¸"))
  (is string= "eckwd4c7cu47r2wf" (encode "ãƒ‰ãƒ¡ã‚¤ãƒ³åä¾‹"))
  (is string= "MajiKoi5-783gue6qz075azm5e" (encode "Majiã§Koiã™ã‚‹5ç§’å‰"))
  (is string= "bcher-kva8445foa" (encode "ã€ŒbÃ¼cherã€"))
  (is string= "xn--eckwd4c7cu47r2wf.com.xn--eckwd4c7cu47r2wf" (encode-domain "ãƒ‰ãƒ¡ã‚¤ãƒ³åä¾‹.com.ãƒ‰ãƒ¡ã‚¤ãƒ³åä¾‹")))

(parachute:define-test decode
  :parent punycode
  (is string= "a" (decode "a-"))
  (is string= "A" (decode "A-"))
  (is string= "3" (decode "3-"))
  (is string= "-" (decode "--"))
  (is string= "--" (decode "---"))
  (is string= "London" (decode "London-"))
  (is string= "Lloyd-Atkinson" (decode "Lloyd-Atkinson-"))
  (is string= "This has spaces" (decode "This has spaces-"))
  (is string= "-> $1.00 <-" (decode "-> $1.00 <--"))
  (is string= "Ð°" (decode "80a"))
  (is string= "Ã¼" (decode "tda"))
  (is string= "Î±" (decode "mxa"))
  (is string= "ä¾‹" (decode "fsq"))
  (is string= "ðŸ˜‰" (decode "n28h"))
  (is string= "Î±Î²Î³" (decode "mxacd"))
  (is string= "MÃ¼nchen" (decode "Mnchen-3ya"))
  (is string= "Mnchen-3ya" (decode "Mnchen-3ya-"))
  (is string= "MÃ¼nchen-Ost" (decode "Mnchen-Ost-9db"))
  (is string= "Bahnhof MÃ¼nchen-Ost" (decode "Bahnhof Mnchen-Ost-u6b"))
  (is string= "abÃ¦cdÃ¶ef" (decode "abcdef-qua4k"))
  (is string= "Ð¿Ñ€Ð°Ð²Ð´Ð°" (decode "80aafi6cg"))
  (is string= "à¸¢à¸ˆà¸†à¸Ÿà¸„à¸à¸‚" (decode "22cdfh1b8fsa"))
  (is string= "ë„ë©”ì¸" (decode "hq1bm8jm9l"))
  (is string= "ãƒ‰ãƒ¡ã‚¤ãƒ³åä¾‹" (decode "eckwd4c7cu47r2wf"))
  (is string= "Majiã§Koiã™ã‚‹5ç§’å‰" (decode "MajiKoi5-783gue6qz075azm5e"))
  (is string= "ã€ŒbÃ¼cherã€" (decode "bcher-kva8445foa"))
  (is string= "ãƒ‰ãƒ¡ã‚¤ãƒ³åä¾‹.com.ãƒ‰ãƒ¡ã‚¤ãƒ³åä¾‹" (decode-domain "xn--eckwd4c7cu47r2wf.com.xn--eckwd4c7cu47r2wf")))
